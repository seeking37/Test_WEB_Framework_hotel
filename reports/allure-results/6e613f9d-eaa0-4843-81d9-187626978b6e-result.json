{"name": "预订成功测试", "status": "broken", "statusDetails": {"message": "selenium.common.exceptions.TimeoutException: Message:", "trace": "self = <testcase.test_reserve_parameterized.TestReserveParameterized object at 0x0000023E2BF3F050>\ndriver = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"5dc2873f1b65ae631ae6bf7a718f4412\")>\ntest_case = {'breakfast_plan': False, 'comment': '', 'contact_type': 'no', 'description': '未登录用户预订成功（初始值）', ...}\n\n    @allure.story(\"预订成功\")\n    @allure.title(\"预订成功测试\")\n    @pytest.mark.parametrize(\"test_case\", TestDataLoader.get_test_cases('../data/reserve_cases.yaml', 'reserve_success_cases'), ids=lambda x: x['id'])\n    @pytest.mark.order(4)\n    def test_reserve_success(self, driver, test_case):\n        \"\"\"测试预订成功\"\"\"\n        self._init_test()\n    \n        with allure.step(f\"执行测试用例: {test_case['description']}\"):\n            reserve_page = self._setup_reserve_page(test_case)\n    \n            # 计算预期的日期和价格\n            if test_case['reserve_date'] == 'tomorrow':\n                expected_start = datetime.now() + timedelta(days=1)\n            elif test_case['reserve_date'] == 'after_90_days':\n                expected_start = datetime.now() + timedelta(days=91)\n            else:\n                expected_start = datetime.now() + timedelta(days=1)  # 默认明天\n    \n            expected_end = expected_start + timedelta(days=int(test_case['reserve_term']))\n            expected_term = f\"{expected_start.strftime(self.LONG_FORMATTER)} - {expected_end.strftime(self.LONG_FORMATTER)}. {test_case['reserve_term']} night(s)\"\n    \n            # 根据计划和星期几计算总金额\n            if test_case['plan_title'] == \"Plan with special offers\":\n                if expected_start.weekday() in [5, 6]:  # 周六日\n                    expected_total_bill = \"Total $87.50 (included taxes)\"\n                else:\n                    expected_total_bill = \"Total $70.00 (included taxes)\"\n            else:  # Premium plan\n                if expected_start.weekday() == 5:  # 周六\n                    expected_total_bill = \"Total $1,120.00 (included taxes)\"\n                elif expected_start.weekday() in [4, 6]:  # 周五或周日\n                    expected_total_bill = \"Total $1,020.00 (included taxes)\"\n                else:\n                    expected_total_bill = \"Total $920.00 (included taxes)\"\n    \n            # 按照Java版本的确切顺序设置预订信息\n            # 1. 设置预订天数（无条件设置，与Java版本保持一致）\n            reserve_page.set_reserve_term(test_case['reserve_term'])\n    \n            # 2. 设置人数（无条件设置，与Java版本保持一致）\n            reserve_page.set_head_count(test_case['head_count'])\n    \n            # 3. 设置额外服务\n            if test_case.get('breakfast_plan'):\n                reserve_page.set_breakfast_plan(test_case['breakfast_plan'])\n            if test_case.get('early_check_in_plan'):\n                reserve_page.set_early_check_in_plan(test_case['early_check_in_plan'])\n            if test_case.get('sightseeing_plan') is not None:\n                reserve_page.set_sightseeing_plan(test_case['sightseeing_plan'])\n    \n            # 4. 设置联系方式\n            if test_case['contact_type'] == 'email':\n                reserve_page.set_contact(Contact.EMAIL)\n                if test_case.get('email'):\n                    reserve_page.set_email(test_case['email'])\n            elif test_case['contact_type'] == 'tel':\n                reserve_page.set_contact(Contact.TELEPHONE)\n                if test_case.get('tel'):\n                    reserve_page.set_tel(test_case['tel'])\n            elif test_case['contact_type'] == 'no':\n                reserve_page.set_contact(Contact.NO)\n    \n            # 5. 设置备注\n            if test_case.get('comment'):\n                reserve_page.set_comment(test_case['comment'])\n    \n            # 6. 重要：日期最后设置（与Java版本保持一致，无条件设置）\n            reserve_page.set_reserve_date(self._get_formatted_date(test_case['reserve_date']))\n    \n            # 提交预订\n>           confirm_page = reserve_page.go_to_confirm_page()\n\ntestcase\\test_reserve_parameterized.py:293: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\npages\\reserve_page.py:149: in go_to_confirm_page\n    return ConfirmPage(self.driver)\npages\\confirm_page.py:32: in __init__\n    self.wait_for_title_contains(\"Confirm Reservation\")\npages\\base_page.py:19: in wait_for_title_contains\n    self.wait.until(EC.title_contains(title))\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <selenium.webdriver.support.wait.WebDriverWait (session=\"5dc2873f1b65ae631ae6bf7a718f4412\")>\nmethod = <function title_contains.<locals>._predicate at 0x0000023E2C032480>\nmessage = ''\n\n    def until(self, method: Callable[[WebDriver], Union[Literal[False], T]], message: str = \"\") -> T:\n        \"\"\"Calls the method provided with the driver as an argument until the \\\n        return value does not evaluate to ``False``.\n    \n        :param method: callable(WebDriver)\n        :param message: optional message for :exc:`TimeoutException`\n        :returns: the result of the last call to `method`\n        :raises: :exc:`selenium.common.exceptions.TimeoutException` if timeout occurs\n        \"\"\"\n        screen = None\n        stacktrace = None\n    \n        end_time = time.monotonic() + self._timeout\n        while True:\n            try:\n                value = method(self._driver)\n                if value:\n                    return value\n            except self._ignored_exceptions as exc:\n                screen = getattr(exc, \"screen\", None)\n                stacktrace = getattr(exc, \"stacktrace\", None)\n            time.sleep(self._poll)\n            if time.monotonic() > end_time:\n                break\n>       raise TimeoutException(message, screen, stacktrace)\nE       selenium.common.exceptions.TimeoutException: Message:\n\nvenv\\Lib\\site-packages\\selenium\\webdriver\\support\\wait.py:101: TimeoutException"}, "description": "测试预订成功", "steps": [{"name": "执行测试用例: 未登录用户预订成功（初始值）", "status": "broken", "statusDetails": {"message": "selenium.common.exceptions.TimeoutException: Message: \n\n", "trace": "  File \"C:\\tocode\\Project\\cursor\\hotel-example\\testcase\\test_reserve_parameterized.py\", line 293, in test_reserve_success\n    confirm_page = reserve_page.go_to_confirm_page()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\venv\\Lib\\site-packages\\allure_commons\\_allure.py\", line 192, in impl\n    return func(*a, **kw)\n           ^^^^^^^^^^^^^^\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\pages\\reserve_page.py\", line 149, in go_to_confirm_page\n    return ConfirmPage(self.driver)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\pages\\confirm_page.py\", line 32, in __init__\n    self.wait_for_title_contains(\"Confirm Reservation\")\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\pages\\base_page.py\", line 19, in wait_for_title_contains\n    self.wait.until(EC.title_contains(title))\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\venv\\Lib\\site-packages\\selenium\\webdriver\\support\\wait.py\", line 101, in until\n    raise TimeoutException(message, screen, stacktrace)\n"}, "steps": [{"name": "设置预订天数", "status": "passed", "parameters": [{"name": "term", "value": "'1'"}], "start": 1751096976393, "stop": 1751096976640}, {"name": "设置人数", "status": "passed", "parameters": [{"name": "head_count", "value": "'1'"}], "start": 1751096976640, "stop": 1751096976860}, {"name": "设置观光计划", "status": "passed", "parameters": [{"name": "checked", "value": "False"}], "start": 1751096976860, "stop": 1751096976926}, {"name": "设置联系方式", "status": "passed", "parameters": [{"name": "contact", "value": "<Contact.NO: 'no'>"}], "start": 1751096976926, "stop": 1751096977111}, {"name": "设置预订日期", "status": "passed", "parameters": [{"name": "date", "value": "'06/29/2025'"}], "start": 1751096977111, "stop": 1751096977866}, {"name": "跳转到确认页面", "status": "broken", "statusDetails": {"message": "selenium.common.exceptions.TimeoutException: Message: \n\n", "trace": "  File \"C:\\tocode\\Project\\cursor\\hotel-example\\venv\\Lib\\site-packages\\allure_commons\\_allure.py\", line 192, in impl\n    return func(*a, **kw)\n           ^^^^^^^^^^^^^^\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\pages\\reserve_page.py\", line 149, in go_to_confirm_page\n    return ConfirmPage(self.driver)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\pages\\confirm_page.py\", line 32, in __init__\n    self.wait_for_title_contains(\"Confirm Reservation\")\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\pages\\base_page.py\", line 19, in wait_for_title_contains\n    self.wait.until(EC.title_contains(title))\n  File \"C:\\tocode\\Project\\cursor\\hotel-example\\venv\\Lib\\site-packages\\selenium\\webdriver\\support\\wait.py\", line 101, in until\n    raise TimeoutException(message, screen, stacktrace)\n"}, "start": 1751096977866, "stop": 1751096988372}], "start": 1751096974444, "stop": 1751096988372}], "parameters": [{"name": "test_case", "value": "{'id': 'guest_user_success', 'description': '未登录用户预订成功（初始值）', 'is_logged_in': False, 'login_email': '', 'login_password': '', 'plan_title': 'Plan with special offers', 'username': 'the tester', 'contact_type': 'no', 'email': '', 'tel': '', 'comment': '', 'reserve_date': 'tomorrow', 'reserve_term': '1', 'head_count': '1', 'breakfast_plan': False, 'early_check_in_plan': False, 'sightseeing_plan': False, 'expected_plan_name': 'Plan with special offers', 'expected_head_count': '1 person(s)', 'expected_plans': 'none', 'expected_username': 'the tester', 'expected_contact': 'not required', 'expected_comment': 'none', 'expected_modal_message': 'We look forward to visiting you.'}"}], "start": 1751096974167, "stop": 1751096988372, "uuid": "f0df9d63-300c-4735-8d22-1f077c0218bd", "historyId": "6d4fcd61e88e54c5d432de5dac6be4b9", "testCaseId": "812c148e5dd67940941304de86d3ace3", "fullName": "testcase.test_reserve_parameterized.TestReserveParameterized#test_reserve_success", "labels": [{"name": "feature", "value": "酒店预订功能（参数化）"}, {"name": "story", "value": "预订成功"}, {"name": "tag", "value": "order(4)"}, {"name": "parentSuite", "value": "testcase"}, {"name": "suite", "value": "test_reserve_parameterized"}, {"name": "subSuite", "value": "TestReserveParameterized"}, {"name": "host", "value": "SQG"}, {"name": "thread", "value": "25904-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "testcase.test_reserve_parameterized"}]}